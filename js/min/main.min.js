!function(){var t,e,a,r;e=800,t=500,d3.json("data/country-coords.json",function(t){return d3.json("data/world-110m.json",function(e){return r(t,e)})}),r=function(r,n){var o,d,u,i,s,l,c,p,g,f,h,y,m,j,v,x,b,w,M,X;for(m=d3.select("body").append("svg"),m.attr({width:e,height:t}),i=function(){var t,e,a,n;for(a=r.features,n=[],t=0,e=a.length;e>t;t++)j=a[t],n.push({name:j.id,lat:j.properties.geo_latitude,lon:j.properties.geo_longitude,value:Math.random()});return n}(),h=d3.geo.robinson().translate([360,180]).scale(100),f=d3.geo.path().projection(h),c=d3.geo.graticule(),p=m.append("g").classed("worldmap",!0),p.append("path").datum(c).classed("graticule",!0).attr("d",f),p.append("path").datum(c.outline).classed("graticule outline",!0).attr("d",f),s=topojson.object(n,n.objects.countries).geometries,p.selectAll(".country").data(s).enter().insert("path",".graticule").classed("country",!0).attr("d",f),l=m.append("g").classed("mapDataLayer",!0),v=0,w=i.length;w>v;v++)d=i[v],d.radius=10*d.value,X=h([d.lon,d.lat]),d.targetX=X[0],d.targetY=X[1],d.x=d.targetX,d.y=d.targetY;for(o=50,g=x=o;0>=o?0>=x:x>=0;g=0>=o?++x:--x)for(y=d3.geom.quadtree(i),b=0,M=i.length;M>b;b++)d=i[b],d.x+=.1*(d.targetX-d.x)*(g/o),d.y+=.1*(d.targetY-d.y)*(g/o),y.visit(a(d));return d=l.selectAll("g.countryMark").data(i).enter().append("g").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("title",function(t){return t.name}),u=d.append("circle").attr("r",function(t){return t.radius})},a=function(t){var e,a,r,n,o;return o=t.radius+16,e=t.x-o,a=t.x+o,r=t.y-o,n=t.y+o,function(d,u,i,s,l){var c,p,g;return d.point&&d.point!==t&&(p=t.x-d.point.x,g=t.y-d.point.y,c=Math.sqrt(p*p+g*g),o=t.radius+d.point.radius,o>c&&(c=.5*((c-o)/c),t.x-=p*=c,t.y-=g*=c,d.point.x+=p,d.point.y+=g)),u>a||e>s||i>n||r>l}}}.call(this);